<!doctype html>
<html lang="uk">
<head>
<!-- ASSISTANT PATCH: early addLine stub v23.14 -->
<script>
(function(){
  window.__BTLIDER_LINES = window.__BTLIDER_LINES || [];
  window.addLine = window.addLine || function(tag,msg,obj){
    try{
      window.__BTLIDER_LINES.push([Date.now(), tag, msg, obj]);
      if(window.__BTLIDER_LINES.length>600) window.__BTLIDER_LINES.shift();
    }catch(e){}
  };
})();
</script>

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>–ü—Ä–æ—Ñ—ñ–ª—å</title>
<style>

html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#eaf2ff;background:#05070c;overflow:hidden}
:root{
  --bg0:#05070c;
  --bg1:#070d18;
  --card:rgba(255,255,255,.06);
  --card2:rgba(10,14,24,.78);
  --stroke:rgba(255,255,255,.10);
  --stroke2:rgba(120,180,255,.18);
  --glowA:rgba(0,255,170,.22);
  --glowB:rgba(40,120,255,.22);
  --txt:rgba(234,242,255,.92);
  --muted:rgba(234,242,255,.68);
  --danger:rgba(255,90,120,.85);
  --safe:rgba(0,255,170,.9);
}
.bg{position:fixed;inset:0;pointer-events:none;background:
 radial-gradient(800px 600px at 15% 15%, var(--glowB), transparent 60%),
 radial-gradient(700px 520px at 85% 20%, var(--glowA), transparent 55%),
 radial-gradient(900px 700px at 50% 110%, rgba(255,0,120,.10), transparent 55%),
 linear-gradient(180deg, var(--bg1), var(--bg0));
 filter:saturate(1.1);
}
.topbar{position:fixed;left:0;right:0;top:0;display:flex;align-items:center;gap:10px;padding:10px 12px;
  background:linear-gradient(180deg, rgba(0,0,0,.62), rgba(0,0,0,.20));
  backdrop-filter: blur(10px);
  border-bottom:1px solid rgba(255,255,255,.08);
  z-index:10;
}
.iconbtn{width:42px;height:42px;border-radius:14px;border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);color:var(--txt);display:grid;place-items:center;
  box-shadow:0 8px 24px rgba(0,0,0,.35);
}
.iconbtn:active{transform:translateY(1px)}
.iconbtn.danger{border-color:rgba(255,90,120,.25);background:rgba(255,90,120,.10)}
.ico{font-size:18px;line-height:1}
.brand{flex:1;display:flex;align-items:center;gap:10px;min-width:0}
.brandMark{width:36px;height:36px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
  background:radial-gradient(circle at 30% 30%, rgba(0,255,170,.30), rgba(40,120,255,.20) 60%, rgba(0,0,0,0) 75%),
             rgba(255,255,255,.05);
  box-shadow:0 0 0 1px rgba(90,160,255,.10) inset, 0 10px 28px rgba(0,0,0,.40);
}
.brandText{min-width:0}
.brandTitle{font-weight:900;letter-spacing:.6px;font-size:13px}
.brandSub{font-size:11px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.content{position:fixed;inset:64px 0 74px 0;overflow:auto;padding:12px 12px 18px}
.card{border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 44px rgba(0,0,0,.45), 0 0 0 1px rgba(90,160,255,.08) inset;
  padding:14px;
}
.hero{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.heroLeft{display:flex;gap:12px;align-items:center}
.avatar{width:56px;height:56px;border-radius:18px;display:grid;place-items:center;font-weight:950;letter-spacing:.6px;
  background:radial-gradient(circle at 30% 30%, rgba(0,255,170,.30), rgba(40,120,255,.22) 58%, rgba(0,0,0,0) 76%),
             rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.14);
}
.heroEmail{font-weight:900;font-size:14px;word-break:break-word}
.heroUid{margin-top:4px;font-size:12px;color:var(--muted)}
.wallet{margin-left:auto;text-align:right;min-width:180px}
.walletLabel{font-size:11px;color:var(--muted)}
.walletValue{font-size:18px;font-weight:950;margin-top:2px}
.walletHint{font-size:11px;color:rgba(234,242,255,.60);margin-top:3px}
.grid{margin-top:12px;display:grid;gap:12px;grid-template-columns:repeat(1,minmax(0,1fr))}
@media (min-width:520px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
.tile{border-radius:18px;background:rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.10);
  padding:14px;box-shadow:0 10px 28px rgba(0,0,0,.35)}
.tileTitle{font-weight:900;font-size:13px}
.tileText{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.35}
.btn{margin-top:10px;width:100%;border-radius:14px;border:1px solid rgba(0,255,170,.22);
  background:linear-gradient(180deg, rgba(0,255,170,.18), rgba(40,120,255,.12));
  color:var(--txt);padding:10px 12px;font-weight:900;letter-spacing:.3px}
.btn:active{transform:translateY(1px)}
.note{margin-top:12px}
.noteTitle{font-weight:950;font-size:13px}
.noteText{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.35}
.bnav{position:fixed;left:0;right:0;bottom:0;display:flex;gap:8px;padding:10px 10px 12px;
  background:linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,.70));
  backdrop-filter: blur(12px);
  border-top:1px solid rgba(255,255,255,.08);
  z-index:10;
}
.bitem{flex:1;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.06);
  border-radius:18px;padding:8px 10px;color:var(--txt);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px}
.bitem.active{border-color:rgba(0,255,170,.26);box-shadow:0 0 0 1px rgba(0,255,170,.10) inset}
.bicon{font-size:16px;line-height:1}
.blabel{font-size:11px;color:var(--muted);font-weight:800}

</style>
</head>
<body>

<div class="bg"></div>

<header class="topbar">
  <button class="iconbtn" id="backBtn" type="button" aria-label="–ù–∞–∑–∞–¥">
    <span class="ico">‚Üê</span>
  </button>
  <div class="brand">
    <div class="brandMark" aria-hidden="true"></div>
    <div class="brandText">
      <div class="brandTitle">BTLIDER</div>
      <div class="brandSub" id="status">‚Ä¶</div>
    </div>
  </div>
  <button class="iconbtn danger" id="logoutBtn" type="button" aria-label="–í–∏–π—Ç–∏">
    <span class="ico">‚éã</span>
  </button>
</header>

<main class="content">
  <section class="card hero">
    <div class="heroLeft">
      <div class="avatar" id="avatar">BT</div>
      <div class="heroMeta">
        <div class="heroEmail" id="email">–ü—Ä–æ—Ñ—ñ–ª—å</div>
        <div class="heroUid">ID: <span id="uid">‚Äî</span></div>
      </div>
    </div>
    <div class="wallet">
      <div class="walletLabel">–ë–∞–ª–∞–Ω—Å</div>
      <div class="walletValue" id="balance">‚Äî</div>
      <div class="walletHint">–î–∂–µ—Ä–µ–ª–æ: Supabase (wallets). –í–∞–ª—é—Ç–∞: <span id="currency">UAH</span></div>
    </div>
  </section>

  <section class="grid">
    <div class="tile">
      <div class="tileTitle">–ü—Ä–æ—Ñ—ñ–ª—å</div>
      <div class="tileText">–î–∞–Ω—ñ –∞–∫–∞—É–Ω—Ç–∞, —Å—Ç–∞—Ç—É—Å —Å–µ—Å—ñ—ó, –≤–∏—Ö—ñ–¥.</div>
    </div>
    <div class="tile">
      <div class="tileTitle">–ë–æ–Ω—É—Å–∏</div>
      <div class="tileText">–ü–µ—Ä–µ—Ö–æ–¥—å —É ‚Äú–ü—Ä–æ–º–æ‚Äù, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –±–æ–Ω—É—Å–∏ —Ç–∞ –∫–≤–µ—Å—Ç–∏.</div>
      <button class="btn" type="button" data-cmd="OPEN_PROMO">–í—ñ–¥–∫—Ä–∏—Ç–∏ –ø—Ä–æ–º–æ</button>
    </div>
    <div class="tile">
      <div class="tileTitle">–ë–µ–∑–ø–µ–∫–∞</div>
      <div class="tileText">–ü—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –æ–Ω–ª–∞–π–Ω-—Å–µ—Å—ñ—è. –û—Ñ–ª–∞–π–Ω –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å.</div>
    </div>
  </section>

  <section class="card note">
    <div class="noteTitle">–ü–æ—è—Å–Ω–µ–Ω–Ω—è</div>
    <div class="noteText">
      –¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–æ–∫–∞–∑—É—î –¥–∞–Ω—ñ —Ç—ñ–ª—å–∫–∏ –∑ –≤–∞—à–æ—ó –ë–î. –Ø–∫—â–æ –±–∞–ª–∞–Ω—Å –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è ‚Äî –∑–Ω–∞—á–∏—Ç—å RLS/—Ç–∞–±–ª–∏—Ü—è wallets –Ω–µ –¥–∞—î –¥–æ—Å—Ç—É–ø –∞–±–æ —Ä—è–¥–æ–∫ –Ω–µ —Å—Ç–≤–æ—Ä–∏–≤—Å—è.
    </div>
  </section>
</main>

<nav class="bnav" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">
  <button class="bitem" type="button" data-cmd="NAV_HOME">
    <div class="bicon">‚åÇ</div><div class="blabel">–ì–æ–ª–æ–≤–Ω–∞</div>
  </button>
  <button class="bitem" type="button" data-cmd="OPEN_PROMO">
    <div class="bicon">‚òÖ</div><div class="blabel">–ü—Ä–æ–º–æ</div>
  </button>
  <button class="bitem active" type="button" data-cmd="OPEN_PROFILE">
    <div class="bicon">üë§</div><div class="blabel">–ü—Ä–æ—Ñ—ñ–ª—å</div>
  </button>
</nav>

<script>
(function(){
  function send(type,payload){
    try{ window.parent && window.parent.postMessage(Object.assign({__btlider:true,type:type}, payload||{}), '*'); }catch(e){}
  }
  function log(msg,obj){ try{ window.parent && window.parent.__BTLIDER_LOG && window.parent.__BTLIDER_LOG(msg,obj||null);}catch(e){} }

  function setText(id, val){ var el=document.getElementById(id); if(el) el.textContent=val; }
  function initials(email){
    if(!email) return 'BT';
    var p=email.split('@')[0].replace(/[^a-z0-9]/ig,'');
    return (p.slice(0,2)||'BT').toUpperCase();
  }

  function render(st){
    if(!st){ setText('status','NO_PARENT'); return; }
    if(st.user){
      setText('email', st.user.email || '–ü—Ä–æ—Ñ—ñ–ª—å');
      setText('uid', st.user.id || '‚Äî');
      var av=document.getElementById('avatar'); if(av) av.textContent=initials(st.user.email);
    }else{
      setText('email','–ì—ñ—Å—Ç—å');
      setText('uid','‚Äî');
    }
    var bal = (st.balance==null)?'‚Äî':(Math.round(Number(st.balance)*100)/100).toFixed(2);
    setText('balance', bal + ' ' + (st.currency||'UAH'));
    setText('currency', String(st.currency||'UAH'));
    setText('status', st.authed ? 'AUTHED' : 'GUEST');
  }

  // initial render
  try{
    var st = window.parent && window.parent.BTLIDER && window.parent.BTLIDER.getState ? window.parent.BTLIDER.getState() : null;
    render(st);
  }catch(e){ setText('status','ERR'); }

  // listen updates
  window.addEventListener('message', function(ev){
    var d = ev && ev.data;
    if(!d || !d.__btlider) return;
    if(d.type==='BTLIDER_AUTH_CHANGED'){
      try{
        render({authed:!!d.authed, user:d.user||null, balance:d.balance, currency:d.currency||'UAH'});
      }catch(e){}
    }
    if(d.type==='BTLIDER_BALANCE'){
      try{
        var cur = String(d.currency||'UAH');
        var bal = (d.balance==null)?'‚Äî':(Math.round(Number(d.balance)*100)/100).toFixed(2);
        setText('balance', bal + ' ' + cur);
        setText('currency', cur);
      }catch(e){}
    }
  });

  document.getElementById('backBtn').addEventListener('click', function(){ send('NAV_HOME'); });
  document.getElementById('logoutBtn').addEventListener('click', function(){
    try{
      var api = window.parent && window.parent.BTLIDER && window.parent.BTLIDER.Auth;
      api && api.logout && api.logout();
    }catch(e){}
  });

  send('NEED_BALANCE');
}
  // bottom nav / commands
  document.addEventListener('click', function(e){
    var b = e.target && e.target.closest ? e.target.closest('[data-cmd]') : null;
    if(!b) return;
    e.preventDefault(); e.stopPropagation();
    var cmd = b.getAttribute('data-cmd');
    if(cmd==='NAV_HOME'){ send('NAV_HOME'); return; }
    if(cmd==='OPEN_PROMO'){ send('OPEN_PROMO'); return; }
    if(cmd==='OPEN_PROFILE'){ send('OPEN_PROFILE'); return; }
  }, true);

})();
</script>

<!-- ASSISTANT PATCH v23.3: balance sync listener (profile.html) -->
<script>
(() => {
  function fmt(b,c) {
    const n = Number(b||0);
    return n.toFixed(2).replace(/\.00$/,'') + (c?(' '+c):'');
  }
  function apply(balance,currency){
    try{
      const text = fmt(balance,currency);
      const nodes = [];
      document.querySelectorAll('[data-btl-balance], #balance, .balance, .js-balance, [class*="balance"], [id*="balance"]').forEach(el=>nodes.push(el));
      // de-dup
      const seen = new Set();
      nodes.forEach(el=>{
        if(!el || seen.has(el)) return; seen.add(el);
        // Avoid overwriting inputs
        if(el.tagName==='INPUT' || el.tagName==='TEXTAREA') return;
        // If element has children and looks like container, try find a numeric span inside
        let target = el;
        const inner = el.querySelector && el.querySelector('.amount,.value,.num,.balance-value,span');
        if(inner && inner.textContent && /\d/.test(inner.textContent)) target = inner;
        target.textContent = text;
      });
    }catch(e){}
  }
  window.addEventListener('message', (ev) => {
    const d = ev.data;
    if(!d || !d.__btlider) return;
    if(d.type==='BTLIDER_BALANCE') {
      apply(d.balance, d.currency);
    }
    if(d.type==='BTLIDER_AUTH_CHANGED') {
      // nothing here; index controls routing
    }
  });
  // ask parent for latest balance when embedded
  try{
    if(window.parent && window.parent !== window) {
      window.parent.postMessage({__btlider:true, type:'NEED_BALANCE'}, '*');
    }
  }catch(e){}
})();
</script>


<!-- ASSISTANT PATCH v23.4: intercept external links / map gorilla routes to our app -->
<script>
(function(){
  function send(type, extra){
    try{ parent && parent.postMessage(Object.assign({__btlider:true,type:type}, extra||{}), '*'); }catch(e){}
  }
  function isExt(href){
    if(!href) return false;
    return /gorilla\.ua|betlider\.ua/i.test(href);
  }
  function classify(href, text){
    href = href || '';
    const t = (text||'').trim().toLowerCase();
    if(/my-account/i.test(href) || /–º—ñ–π –∞–∫–∞—É–Ω—Ç|–º–æ–π –∞–∫–∫–∞—É–Ω—Ç|account|–ø—Ä–æ—Ñ(—ñ|–∏)–ª/i.test(t)) return 'PROFILE';
    if(/promo|bonus|quest|promocode/i.test(href) || /–ø—Ä–æ–º–æ|–±–æ–Ω—É—Å|–∫–≤–µ—Å—Ç|–ø—Ä–æ–º–æ–∫–æ–¥/i.test(t)) return 'PROMO';
    return 'STUB';
  }
  document.addEventListener('click', function(e){
    const a = e.target && (e.target.closest ? e.target.closest('a') : null);
    if(!a) return;
    const href = a.getAttribute('href') || '';
    if(href.startsWith('#BTLIDER_PROMO')){ e.preventDefault(); e.stopPropagation(); send('OPEN_PROMO'); return; }
    if(href.startsWith('#BTLIDER_PROFILE')){ e.preventDefault(); e.stopPropagation(); send('OPEN_PROFILE'); return; }
    if(isExt(href)){
      const kind = classify(href, a.textContent||'');
      e.preventDefault(); e.stopPropagation();
      if(kind==='PROFILE'){ send('OPEN_PROFILE'); return; }
      if(kind==='PROMO'){ send('OPEN_PROMO'); return; }
      send('OPEN_STUB', {href:href, label:(a.textContent||'').trim().slice(0,80)});
      try{ parent.__BTLIDER_LOG && parent.__BTLIDER_LOG('warn','NAV_BLOCKED (external)', {href:href}); }catch(_e){}
    }
  }, true);
})();
</script>


<!-- ASSISTANT PATCH v23.6: BALANCE + NAV hooks (keep visual, no gorilla nav) -->
<script>
(function(){
  if(window.__BTLIDER_BAL_NAV_HOOKS) return; window.__BTLIDER_BAL_NAV_HOOKS=true;
  function post(type, extra){ try{ parent && parent.postMessage(Object.assign({__btlider:true,type:type}, extra||{}), '*'); }catch(e){} }
  function applyBalance(bal, cur){
    try{
      var val = (bal===null||bal===undefined) ? '--' : String(bal);
      var curTxt = cur || 'UAH';
      var txt = val + ' ' + curTxt;
      var sel = [
        '[data-btl-balance]',
        '#balance','#userBalance','#walletBalance',
        '[id*="balance" i]','[class*="balance" i]',
        '[id*="wallet" i]','[class*="wallet" i]',
        '[class*="money" i]','[class*="amount" i]','[class*="sum" i]','[class*="cash" i]'
      ].join(',');
      var nodes = Array.prototype.slice.call(document.querySelectorAll(sel));
      nodes.forEach(function(n){
        if(!n) return;
        // do not overwrite large blocks
        var t = (n.textContent||'').trim();
        if(t.length>0 && t.length<60){
          n.textContent = txt;
        }else if(n.hasAttribute('data-btl-balance')){
          n.textContent = txt;
        }
      });
      // Offline/localStorage balance removed: Supabase DB is source of truth
    }catch(e){}
  }
  // ask parent for balance once
  try{ post('NEED_BALANCE'); }catch(e){}
  window.addEventListener('message', function(ev){
    var d = ev && ev.data;
    if(!d || !d.__btlider) return;
    if(d.type==='BTLIDER_BALANCE'){
      applyBalance(d.balance, d.currency);
    }
  });
  // nav hooks
  function norm(s){ return (s||'').toString().trim().toLowerCase(); }
  document.addEventListener('click', function(e){
    try{
      var t = e.target;
      if(!t) return;
      var a = t.closest ? t.closest('a,button,[role="button"]') : null;
      if(!a) return;
      var href = (a.getAttribute && (a.getAttribute('href')||a.getAttribute('data-href')||'')) || '';
      var txt = norm(a.textContent||'');
      var idc = norm((a.id||'')+' '+(a.className||'')+' '+(a.getAttribute && (a.getAttribute('aria-label')||'')));
      var isProfile = href.indexOf('/my-account')>-1 || href.indexOf('my-account')>-1 || idc.indexOf('account')>-1 || idc.indexOf('profile')>-1 || txt==='–ø—Ä–æ—Ñ—ñ–ª—å' || txt==='–ø—Ä–æ—Ñ–∏–ª—å';
      var isPromo = href.indexOf('promo')>-1 || href.indexOf('bonus')>-1 || href.indexOf('quest')>-1 || href.indexOf('#btlider_promo')>-1 || idc.indexOf('promo')>-1 || idc.indexOf('bonus')>-1 || txt.indexOf('–ø—Ä–æ–º–æ')>-1 || txt.indexOf('–±–æ–Ω—É—Å')>-1;
      if(isProfile){
        e.preventDefault(); e.stopPropagation();
        post('OPEN_PROFILE');
        return;
      }
      if(isPromo){
        e.preventDefault(); e.stopPropagation();
        post('OPEN_PROMO');
        return;
      }
      // block external gorilla links
      if(href && (href.indexOf('gorilla.ua')>-1 || href.indexOf('betlider.ua')>-1)){
        e.preventDefault(); e.stopPropagation();
        post('OPEN_STUB',{label:'–°–∫–æ—Ä–æ'});
        return;
      }
    }catch(_){}
  }, true);
})();
</script>
<!-- /ASSISTANT PATCH v23.6 -->

<!-- ASSISTANT PATCH: universal diag + loader failsafe v23.14 -->
<script>
(function(){
  'use strict';
  function ts(){
    try{
      const d=new Date();
      return d.toTimeString().slice(0,8);
    }catch(e){ return ''; }
  }
  function safeJson(o){
    try{ return JSON.stringify(o); }catch(e){ return String(o); }
  }
  function pushLine(tag,msg,obj){
    window.__BTLIDER_LINES = window.__BTLIDER_LINES || [];
    window.__BTLIDER_LINES.push([Date.now(), tag, msg, obj]);
    if(window.__BTLIDER_LINES.length>800) window.__BTLIDER_LINES.shift();
  }
  // Hard guarantee
  window.addLine = window.addLine || function(tag,msg,obj){ pushLine(tag,msg,obj); };

  // Capture errors for everyone (temporary)
  window.addEventListener('error', function(e){
    pushLine('ERROR', (e && e.message) ? e.message : 'error', {filename:e && e.filename, lineno:e && e.lineno, colno:e && e.colno});
  });
  window.addEventListener('unhandledrejection', function(e){
    var r = e && e.reason;
    pushLine('REJECT', (r && (r.message||r.toString())) || 'unhandledrejection', {reason: (r && (r.stack||r.message)) || String(r)});
  });

  function mount(){
    if(document.getElementById('btlDiagPanel')) return;
    var wrap=document.createElement('div');
    wrap.id='btlDiagPanel';
    wrap.style.cssText='position:fixed;left:8px;bottom:68px;width:min(360px,92vw);max-height:42vh;z-index:2147483647;background:rgba(0,0,0,.72);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.18);border-radius:14px;overflow:hidden;font:12px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#fff;';
    var head=document.createElement('div');
    head.style.cssText='display:flex;align-items:center;gap:8px;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.12);';
    head.innerHTML='<div style="font-weight:700;letter-spacing:.2px;">BTLIDER LOG</div><div style="opacity:.75;flex:1;">(—Ç–∏–º—á–∞—Å–æ–≤–æ –¥–ª—è –≤—Å—ñ—Ö)</div>';
    var btnCopy=document.createElement('button');
    btnCopy.textContent='COPY';
    btnCopy.style.cssText='background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.18);border-radius:10px;padding:6px 10px;font-weight:700;';
    var btnHide=document.createElement('button');
    btnHide.textContent='HIDE';
    btnHide.style.cssText=btnCopy.style.cssText;
    btnHide.onclick=function(){ wrap.style.display='none'; };
    btnCopy.onclick=function(){
      try{
        var lines=(window.__BTLIDER_LINES||[]).slice(-250).map(function(x){
          var t = ts();
          try{ t = new Date(x[0]).toTimeString().slice(0,8); }catch(e){}
          var tag=x[1], msg=x[2], obj=x[3];
          return '['+t+'] '+tag+': '+msg+(obj!==undefined ? ' | '+safeJson(obj) : '');
        }).join('
');
        navigator.clipboard.writeText(lines).then(function(){
          pushLine('COPIED','OK');
        }).catch(function(){
          pushLine('COPIED','FAILED');
        });
      }catch(e){ pushLine('COPIED','EX', String(e && e.message || e)); }
    };
    head.appendChild(btnCopy);
    head.appendChild(btnHide);

    var body=document.createElement('div');
    body.id='btlDiagBody';
    body.style.cssText='padding:8px 10px;overflow:auto;max-height:34vh;white-space:pre-wrap;word-break:break-word;';
    wrap.appendChild(head);
    wrap.appendChild(body);
    document.body.appendChild(wrap);

    function render(){
      var arr=(window.__BTLIDER_LINES||[]).slice(-200);
      body.textContent=arr.map(function(x){
        var t=ts(); try{ t=new Date(x[0]).toTimeString().slice(0,8);}catch(e){}
        return '['+t+'] '+x[1]+': '+x[2]+(x[3]!==undefined ? ' | '+safeJson(x[3]) : '');
      }).join('
');
      body.scrollTop = body.scrollHeight;
    }
    render();
    setInterval(render, 700);
  }

  function loaderFailsafe(){
    try{
      // remove common full-screen blockers
      var kill = [
        '#preloader','#loader','#loading','#loadingOverlay','.preloader','.loader','.loading-overlay','.loadingOverlay','[data-btl-loader]','[data-loader]'
      ];
      kill.forEach(function(sel){
        document.querySelectorAll(sel).forEach(function(el){
          try{ el.style.display='none'; }catch(e){}
        });
      });
      if(document.documentElement) document.documentElement.classList.remove('loading');
      if(document.body) document.body.classList.remove('loading');
      pushLine('DIAG','loader failsafe executed');
    }catch(e){
      pushLine('DIAG','loader failsafe error', String(e && e.message || e));
    }
  }

  document.addEventListener('DOMContentLoaded', function(){
    mount();
    // If anything still blocks after 7s, kill it
    setTimeout(loaderFailsafe, 7000);
  });

  // If DOM already loaded
  if(document.readyState === 'interactive' || document.readyState === 'complete'){
    setTimeout(function(){ try{ mount(); }catch(e){} }, 0);
    setTimeout(loaderFailsafe, 7000);
  }
})();
</script>

</body>
</html>
